<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI News Summary</title>
    <link rel="stylesheet" href="/static/style.css">  <!-- ‚úÖ Corrected Path -->
</head>
     
<body>
    <h1>AI News Summary</h1>
    <p>Enter a topic to get the latest AI-generated news summary.</p>
    
    <input type="text" id="topicInput" placeholder="Enter a topic...">
    <button onclick="fetchSummary()">Get Summary</button>

    <div id="result"></div>

    <script>
        async function fetchSummary() {
            console.log("üî• fetchSummary() function triggered!");
    
            const topic = document.getElementById("topicInput").value.trim();
            const resultDiv = document.getElementById("result");
    
            if (!topic) {
                resultDiv.innerHTML = "<p style='color: red;'>Please enter a topic!</p>";
                return;
            }
    
            resultDiv.innerHTML = "<p>Loading...</p>";
    
            const BASE_URL = window.location.hostname.includes("localhost") 
                ? "http://127.0.0.1:8000" 
                : "https://azukimedia.up.railway.app";
    
            try {
                console.log(`üîó Fetching: ${BASE_URL}/summary/${encodeURIComponent(topic)}`);
    
                const response = await fetch(`${BASE_URL}/summary/${encodeURIComponent(topic)}`, {
                    method: "GET",
                    headers: { "Accept": "application/json" }
                });
    
                console.log("üü¢ Response Status:", response.status);
    
                if (!response.ok) {
                    throw new Error(`‚ùå Server error: ${response.status} - ${response.statusText}`);
                }
    
                const data = await response.json();
                console.log("‚úÖ API Response:", data);
    
                let summaryText = "No summary available.";
                let imageUrl = "";  
                let sourceUrl = ""; 
    
                if (typeof data.summary === "string") {
                    summaryText = data.summary.replace(/\n/g, "<br>");  
                } else if (data.summary && typeof data.summary.raw === "string") {
                    summaryText = data.summary.raw.replace(/\n/g, "<br>");
                }
    
                // üîπ Convert Markdown Links into Clickable HTML Links
                summaryText = summaryText.replace(/\[([^\]]+)\]\((https?:\/\/[^\)]+)\)/g, '<a href="$2" target="_blank">$1</a>');
    
                // üîπ Extract the FIRST Image URL if available
                const imageMatch = data.summary.match(/!\[.*?\]\((https?:\/\/[^\)]+)\)/);
                if (imageMatch) {
                    imageUrl = imageMatch[1];  // ‚úÖ Extract URL
                    summaryText = summaryText.replace(imageMatch[0], "");  // ‚úÖ Remove image markdown from text
                    sourceUrl = imageUrl; // ‚úÖ Link the image to its source
                }
    
                // üîπ Generate a fake timestamp (current time)
                const tweetDate = new Date().toLocaleString("en-US", { weekday: "short", month: "short", day: "numeric", year: "numeric", hour: "2-digit", minute: "2-digit" });
    
                resultDiv.innerHTML = `
                    <div class="tweet-container">
                        <div class="tweet-header">
                            <img class="profile-pic" src="https://abs.twimg.com/sticky/default_profile_images/default_profile_400x400.png" alt="Profile">
                            <div>
                                <div class="tweet-username">AzukiMedia</div>
                                <div class="tweet-meta">@azukimedia ¬∑ ${tweetDate}</div>
                            </div>
                        </div>
                        <div class="tweet-body">${summaryText}</div>
                        ${imageUrl ? `<a href="${sourceUrl}" target="_blank"><img class="tweet-image" src="${imageUrl}" alt="Tweet Image"></a>` : ""}
                    </div>
                `;
            } catch (error) {
                console.error("üö® Fetch error:", error);
                resultDiv.innerHTML = `<p style='color: red;'>Error fetching summary: ${error.message}. Try again!</p>`;
            }
        }
    </script>            
</body>
</html>
