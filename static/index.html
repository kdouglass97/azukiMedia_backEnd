<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI News Summary</title>
</head>
<body>
    <h1>AI News Summary</h1>
    <p>Enter a topic to get the latest AI-generated news summary.</p>
    
    <input type="text" id="topicInput" placeholder="Enter a topic...">
    <button onclick="fetchSummary()">Get Summary</button>

    <div id="result"></div>

    <script>
        async function fetchSummary() {
            console.log("üî• fetchSummary() function triggered!");

            const topic = document.getElementById("topicInput").value.trim();
            const resultDiv = document.getElementById("result");

            if (!topic) {
                resultDiv.innerHTML = "<p style='color: red;'>Please enter a topic!</p>";
                return;
            }

            resultDiv.innerHTML = "<p>Loading...</p>";

            const BASE_URL = window.location.hostname.includes("localhost") 
                ? "http://127.0.0.1:8000" 
                : "https://azukimedia.up.railway.app";

            try {
                console.log(`üîó Fetching: ${BASE_URL}/summary/${encodeURIComponent(topic)}`);

                const response = await fetch(`${BASE_URL}/summary/${encodeURIComponent(topic)}`, {
                    method: "GET",
                    headers: { "Accept": "application/json" }
                });

                console.log("üü¢ Response Status:", response.status);

                if (!response.ok) {
                    throw new Error(`‚ùå Server error: ${response.status} - ${response.statusText}`);
                }

                const data = await response.json();
                console.log("‚úÖ API Response:", data);  // ‚úÖ Log the full response

                // üîπ Ensure `data.summary` is correctly displayed
                let summaryText = "No summary available.";
                if (typeof data.summary === "string") {
                    summaryText = data.summary.replace(/\n/g, "<br>");  // ‚úÖ Convert line breaks to HTML
                } else if (data.summary && typeof data.summary.raw === "string") {
                    summaryText = data.summary.raw.replace(/\n/g, "<br>");  // ‚úÖ Handle nested object case
                }

                resultDiv.innerHTML = `
                    <h3>üì¢ Latest "${topic}" Updates:</h3>
                    <div style="background:#F5F8FA; border-radius:10px; padding:15px; text-align:left;">
                        ${summaryText}
                    </div>
                `;
            } catch (error) {
                console.error("üö® Fetch error:", error);
                resultDiv.innerHTML = `<p style='color: red;'>Error fetching summary: ${error.message}. Try again!</p>`;
            }
        }
    </script>
</body>
</html>
